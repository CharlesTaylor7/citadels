{% extends "base.html" %} 
{% block content %}
<main 
  id="main" 
  data-replace-url="/game" 
  data-theme="retro"
  class="
    h-screen
    flex flex-row
  "
>
    <div
      id="roles"
      class="min-w-72 p-2 bg-neutral-content flex flex-col items-center border border-base-200"
    >
      <h2 class="m-2 underline text-lg font-semibold">Roles</h2>

      <div class="flex flex-col gap-2">
        <div class="italic text-sm">Hover over a role for details</div>
        {% for role in characters %}
          <div
            data-tip="{{ role.description }}"
            class="
              cursor-pointer
              text-left 
              tooltip tooltip-right tooltip-secondary
            "
          >
            {{ role.rank }}. {{ role.name }}
          </div>
        {% endfor %}
      </div>
    </div>

    <section
      id="main-panel"
      class="grow flex flex-col"
    >

      <form
        id="actions"
        class="p-2 bg-neutral-content grow flex flex-col gap-2 items-center border border-base-200"
        _="
          on click 
            call document.querySelectorAll('button:disabled')
            set btns to the result
            for btn in btns
              remove @disabled from btn
            end
        "
      >
        {% match phase %} 
        {% when GamePhase::Draft %}
        <h2 class="m-2 underline text-lg font-semibold">
          Draft
        </h2>
        {% if active_name == my.name %}
        {% include "draft.html" %}
        {% endif %}
        {% when GamePhase::Call %}
        <h2 class="m-2 underline text-lg font-semibold">
          Actions
        </h2>
        {% endmatch %}
      </form>
      <div
        id="city"
        class="p-2 bg-neutral-content grow flex flex-col items-center border border-base-200"
      >
        <h2 class="m-2 underline text-lg font-semibold">City</h2>

      </div>
      <div
        id="hand"
        class="p-2 bg-neutral-content grow flex flex-col overflow-scroll items-start border border-base-200"
      >
        <h2 class="m-2 underline m-2 text-lg font-semibold w-full text-center">
          Hand
        </h2>
        <div class="flex flex-row flex-wrap gap-2">
          {% set class = "tooltip-top" %}
          {% set input_type = "" %}
            {% for role in my.roles %} 
              {% include "role-card.html" %} 
            {% endfor %} 
            {% let input_type = "checkbox" %}
            {% for district in my.hand %} 
              {% include "district-card.html" %} 
            {% endfor %}
        </div>
      </div>

    </section>

    <div
      id="players"
      class="px-4 bg-neutral-content border border-base-200 flex flex-col items-center gap-2"
    >
      <h2 class="m-2 underline text-lg font-semibold">Players</h2>
      <div class="italic text-sm">Hover over a player to see more details</div>
      {% if dev_mode && my.name.borrow() != active_name %}
      <button
        class="btn btn-secondary h-8 min-h-8 animate-none m-2 "
        hx-swap="morph"
        hx-post="/game/impersonate/active"

      >
        Follow Active
      </button>
      {% endif %}
      <div class="flex flex-col gap-2">
        {% for player in players %}
        {% include "player-summary.html" %}
        {% endfor %}
      </div>
    </div>
</main>
{% endblock %}
